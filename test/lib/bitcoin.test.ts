import {providers} from 'ethers';
import {VoidSigner} from 'ethers';

import FakeWeb3Provider from './helpers/FakeWeb3Provider';

import {XOpts} from '../../lib/xopts';
import {Deployments} from '../../lib/addresses';
import {expect} from 'chai';
import {getRequest} from '../../lib/bitcoin/request';

describe('Bitcoin', () => {
  it('should find txid matching request id', async () => {
    const txs = [
      {
        txid:
          '75cfdf956f130febfd3893713cb669e08e8e5141034a074edb50f232ed464227',
        hex:
          '01000000000103c5c371634e4fe93a3d0fb6858a84c1f76b83e02cb9c02c16648302c4d083282c0100000000ffffffffe7f3a24685123b4eb4a8422f0e302fb7d53a1ea90f8b4fc61c7e68c78dc286540000000000ffffffff95465422654b2603a45a987ec39420d5329f0ae86f986bf08c44444523d088410000000000ffffffff015e97120000000000160014867a55207369ad0fe47cf3cfd2ecbaef2446c8b40248304502210094644bfd49768eeeae1100c6c844289b7fcbf36d8c90682d158d7cc954339327022037844028cf25e7112ac2915f1763bf831184a40623b4e73da9c6c73d4d07984201210333b0b0826540f5d50667d5e4e400aabbcd403d0ddcef3cbb5d9aa067106161650247304402205451c85eab945806f0e902fdf82aac22ffb61a7044dbe3a54f44aa0399eac1b802202d103ecb3e2948cd6a719b8304b976fe3b37753c49ca2d21143114c2efaf6a2401210333b0b0826540f5d50667d5e4e400aabbcd403d0ddcef3cbb5d9aa0671061616502473044022069e60cc762738a1e1b65589bc6ec163819d3d7a5b3778f4cbeb868fe9791d11d022035105daa3bf795d697396cd65081d32ff69140ed4432062e1a3fd3c4c9b9748401210333b0b0826540f5d50667d5e4e400aabbcd403d0ddcef3cbb5d9aa0671061616500000000'
      },
      {
        txid:
          '4188d0234544448cf06b986fe80a9f32d52094c37e985aa403264b6522544695',
        hex:
          '010000000001025f18e38d9af2de267caae30c02f454bf31c2d6b2edb2df6ca5aba222a4ffd4e00100000000ffffffff3113a1b5948862a31975cd7aecff240e4e1c8903497ae9d7114ce790e803fefe0000000000ffffffff01d885010000000000160014867a55207369ad0fe47cf3cfd2ecbaef2446c8b402483045022100a1749197a4e52d5e53dd78885470442df559f33486b91ef05bd09f6c03c481480220721e8a1e91c6b9ccb50ae78aa6e91e083ff37bdabed4f59331718fa8dbbac61401210333b0b0826540f5d50667d5e4e400aabbcd403d0ddcef3cbb5d9aa06710616165024730440220712ecbd7ed701056a6415da039c1a7cb27fedb090dfec6e1d8dec439ae764877022064358286aacc701e302262a6789da8f9417d68d1160137da8b7da314e9df27a901210333b0b0826540f5d50667d5e4e400aabbcd403d0ddcef3cbb5d9aa0671061616500000000'
      },
      {
        txid:
          '5486c28dc7687e1cc64f8b0fa91e3ad5b72f300e2f42a8b44e3b128546a2f3e7',
        hex:
          '01000000000101f89a9e503f5e715e82d9a4794405f3f7ed1579896051f26fd3ac98844e9c0fe10000000000ffffffff026aec100000000000160014867a55207369ad0fe47cf3cfd2ecbaef2446c8b40000000000000000226a20000000000000000000000000000000000000000000000000000000000000000002473044022001693a71497fafc636aaff9c936d751c6a01f4c4221133823878fc67c3f147c702201511564af6fd7e46416a15d3efb2bdeb206b1f7cef10eb8db83688c0ea78233101210333b0b0826540f5d50667d5e4e400aabbcd403d0ddcef3cbb5d9aa0671061616500000000'
      },
      {
        txid:
          'e10f9c4e8498acd36ff25160897915edf7f3054479a4d9825e715e3f509e9af8',
        hex:
          '01000000000101b1a2c111be867141996abe6e86cc699b3470eee35b7fe560afcee21b745ea4790100000000ffffffff0132ed100000000000160014867a55207369ad0fe47cf3cfd2ecbaef2446c8b402483045022100b8f3002cb31694f1721f11f7a537bed5d6cbe108a7e4900a2855f2b6098d1c1e02200c2e721b333685e1c0d75c22b0b3c9f537490058d7cf2809144fd6494469fc3a01210333b0b0826540f5d50667d5e4e400aabbcd403d0ddcef3cbb5d9aa0671061616500000000'
      },
      {
        txid:
          '2c2883d0c4028364162cc0b92ce0836bf7c1848a85b60f3d3ae94f4e6371c3c5',
        hex:
          '020000000001010dab984ae9668713fd3cbf7f00a0ce6be7827fc41a175344f036b1e00dc1f1130100000017160014ea6e392dd0f63116e25acd7512400903714644f2feffffff02a01dbd07000000001600149174157c13f6a02ec044fc63c29e22a2f4e812421027000000000000160014867a55207369ad0fe47cf3cfd2ecbaef2446c8b40247304402205cab7fab511578990cd5c23497fc21652acd5b0a303e2ef0740fc131bef0cf850220684eaee1a60b2b9ed9a0f32950c6a034a26bcf100dc051df8918d2119bc7fac10121025904ecabfa90a15ceafaca76e040650e43c33be9f268d3885c4ea6fc9fe5a64257951b00'
      },
      {
        txid:
          '79a45e741be2ceaf60e57f5be3ee70349b69cc866ebe6a99417186be11c1a2b1',
        hex:
          '02000000000101d66c6a672e6cd24a1c5dfb4ddae0da20294b2063da7868dbee942dad3b8e71420100000000feffffff022541df2300000000160014cdee5df0b5a15a53b5a6be0bc369083a1c57891aaded100000000000160014867a55207369ad0fe47cf3cfd2ecbaef2446c8b402473044022060ee274ed2b514510b1d3f5910955f11a467dab7df0711bca05f4f9e8bede5b1022054a9a8548d36f9775f3f2631d9103479a4356b8116b3890df72106a33b552c4d0121031a2012bc514afa435b569581089ba2939f599e9397eecb7f8f20e7ebfc5aafe357951b00'
      },
      {
        txid:
          'e0d4ffa422a2aba56cdfb2edb2d6c231bf54f4020ce3aa7c26def29a8de3185f',
        hex:
          '020000000001012f14998ce5ab2ec93265312b6fd7081a7252049c341bafff556a6736a0cc809f0100000017160014deda740bceb543dae1f57546a156a96dfe171b19feffffff02eabf1900000000001600144c514a3a5764a9842dfc9f08b4a66d6d0d44962ba086010000000000160014867a55207369ad0fe47cf3cfd2ecbaef2446c8b40247304402207cf230992613703cbd78b948dd86e963873f502ac70e2c3dcfed6b92b16d7ecb02207384baf115836896cf8ac510d895f4bd54cd0eb7467bbc6ecff28f8d5c13bfae012102370cfbea232277fdf326185fa4f9c6cacf71799b0a08f6ea26d92b4f29d4abb357951b00'
      },
      {
        txid:
          'fefe03e890e74c11d7e97a4903891c4e0e24ffec7acd7519a3628894b5a11331',
        hex:
          '01000000000101747c038ceb0a5ab9edd61d39f3d3c611cd52ccd0f519d9ad93ccf1f81a0fc5d30100000000ffffffff016400000000000000160014867a55207369ad0fe47cf3cfd2ecbaef2446c8b402483045022100d905282bcfe2b52f1643be7cf04f6ef9b9f6ecfd3d7246dc4700d0d8c4467ad50220744bc0266c778c277a12f6933deb09f19f6d941aadbe451f9a17eb52768504c001210290465bd783baaa9d52df3b57e31cef7df72c0cbd10afe6a10e3cfbd9477c8acf00000000'
      },
      {
        txid:
          '62c2d275abeede879db1f32aea788bb4bfbcedbc97d8c3e79f85151288549ea8',
        hex:
          '01000000000101274246ed32f250db4e074a0341518e8ee069b63c719338fdeb0f136f95dfcf750000000000ffffffff023296120000000000160014867a55207369ad0fe47cf3cfd2ecbaef2446c8b40000000000000000226a20bb098b68899b1f586de557dae6bae76093ae4206039c43c89031ae77352268ba0247304402201c3ad28ba2e2006890642b869fd603a701d29162bbb6270c9f9f2f2b77f5d59602204f6952866977048669f0776adf4e4de7590017a8dbd7b6cf32e152769adef40c01210333b0b0826540f5d50667d5e4e400aabbcd403d0ddcef3cbb5d9aa0671061616500000000'
      }
    ];

    const id = await getRequest(
      'tb1qsea92grndxksleru708a9m96aujydj95s5edsj',
      'bb098b68899b1f586de557dae6bae76093ae4206039c43c89031ae77352268ba',
      {
        getTxHistory: async (addr: string) => {
          return txs;
        }
      },
      {
        getTxHex: async (txId: string) => {
          return txs.find((tx) => tx.txid === txId)!.hex;
        }
      }
    );
    expect(id).to.eq(
      '62c2d275abeede879db1f32aea788bb4bfbcedbc97d8c3e79f85151288549ea8'
    );
  });
});
